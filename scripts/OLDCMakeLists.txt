cmake_minimum_required (VERSION 3.5)
project (kng.compiler)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# stops ZERO_BUILD from being generated
set(CMAKE_SUPPRESS_REGENERATION true)

set(EXEC Release)

if(NOT LLVM_DIR) 
	message(FATAL_ERROR "LLVM_DIR is required to build KNG")
endif()


include_directories(
	${LLVM_DIR}/include
	../src/vendor/cxxopts/include
	../src/vendor/Catch2-2.13.3/include
	../src/vendor/spdlog-1.8.1/include
	../src
)

# link in LLVM libraries
# the ones commented out below are the ones that specify "no rule to make", will fix in the future
set(LLVM_LIBRARIES_PATH ${LLVM_DIR}/Release/lib)
link_directories(
	${LLVM_LIBRARIES_PATH}
	)

set(ALL_FILES 
	../src/ast.cpp
	../src/common.cpp
	../src/compiler.cpp
	../src/error.cpp
	../src/exporter.cpp
	../src/generator.cpp
	../src/lexer.cpp
	../src/main.cpp
	../src/parser.cpp
	../src/token.cpp
	../src/typechecking.cpp
	../src/types.cpp
	)

set (LLVM_LIBS
    ${LLVM_LIBRARIES_PATH}/DynamicLibraryLib.lib
	${LLVM_LIBRARIES_PATH}/ExampleIRTransforms.lib
	${LLVM_LIBRARIES_PATH}/gtest.lib
	${LLVM_LIBRARIES_PATH}/gtest_main.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch4.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch5.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch6.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch7.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch8.lib
	${LLVM_LIBRARIES_PATH}/Kaleidoscope-Ch9.lib
	${LLVM_LIBRARIES_PATH}/LLVM-C.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64AsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64CodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64Desc.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64Disassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64Info.lib
	${LLVM_LIBRARIES_PATH}/LLVMAArch64Utils.lib
	${LLVM_LIBRARIES_PATH}/LLVMAggressiveInstCombine.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMAMDGPUUtils.lib
	${LLVM_LIBRARIES_PATH}/LLVMAnalysis.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMARMUtils.lib
	${LLVM_LIBRARIES_PATH}/LLVMAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMAsmPrinter.lib
	${LLVM_LIBRARIES_PATH}/LLVMAVRAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMAVRCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMAVRDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMAVRDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMAVRInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMBinaryFormat.lib
	${LLVM_LIBRARIES_PATH}/LLVMBitReader.lib
	${LLVM_LIBRARIES_PATH}/LLVMBitstreamReader.lib
	${LLVM_LIBRARIES_PATH}/LLVMBitWriter.lib
	${LLVM_LIBRARIES_PATH}/LLVMBPFAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMBPFCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMBPFDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMBPFDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMBPFInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMCFGuard.lib
	${LLVM_LIBRARIES_PATH}/LLVMCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMCore.lib
	${LLVM_LIBRARIES_PATH}/LLVMCoroutines.lib
	${LLVM_LIBRARIES_PATH}/LLVMCoverage.lib
	${LLVM_LIBRARIES_PATH}/LLVMDebugInfoCodeView.lib
	${LLVM_LIBRARIES_PATH}/LLVMDebugInfoDWARF.lib
	${LLVM_LIBRARIES_PATH}/LLVMDebugInfoGSYM.lib
	${LLVM_LIBRARIES_PATH}/LLVMDebugInfoMSF.lib
	${LLVM_LIBRARIES_PATH}/LLVMDebugInfoPDB.lib
	${LLVM_LIBRARIES_PATH}/LLVMDemangle.lib
	${LLVM_LIBRARIES_PATH}/LLVMDlltoolDriver.lib
	${LLVM_LIBRARIES_PATH}/LLVMDWARFLinker.lib
	${LLVM_LIBRARIES_PATH}/LLVMExecutionEngine.lib
	${LLVM_LIBRARIES_PATH}/LLVMExtensions.lib
	${LLVM_LIBRARIES_PATH}/LLVMFileCheck.lib
	${LLVM_LIBRARIES_PATH}/LLVMFrontendOpenACC.lib
	${LLVM_LIBRARIES_PATH}/LLVMFrontendOpenMP.lib
	${LLVM_LIBRARIES_PATH}/LLVMFuzzMutate.lib
	${LLVM_LIBRARIES_PATH}/LLVMGlobalISel.lib
	${LLVM_LIBRARIES_PATH}/LLVMHelloNew.lib
	${LLVM_LIBRARIES_PATH}/LLVMHexagonAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMHexagonCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMHexagonDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMHexagonDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMHexagonInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMInstCombine.lib
	${LLVM_LIBRARIES_PATH}/LLVMInstrumentation.lib
	${LLVM_LIBRARIES_PATH}/LLVMInterfaceStub.lib
	${LLVM_LIBRARIES_PATH}/LLVMInterpreter.lib
	${LLVM_LIBRARIES_PATH}/LLVMipo.lib
	${LLVM_LIBRARIES_PATH}/LLVMIRReader.lib
	${LLVM_LIBRARIES_PATH}/LLVMJITLink.lib
	${LLVM_LIBRARIES_PATH}/LLVMLanaiAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMLanaiCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMLanaiDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMLanaiDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMLanaiInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMLibDriver.lib
	${LLVM_LIBRARIES_PATH}/LLVMLineEditor.lib
	${LLVM_LIBRARIES_PATH}/LLVMLinker.lib
	${LLVM_LIBRARIES_PATH}/LLVMLTO.lib
	${LLVM_LIBRARIES_PATH}/LLVMMC.lib
	${LLVM_LIBRARIES_PATH}/LLVMMCA.lib
	${LLVM_LIBRARIES_PATH}/LLVMMCDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMMCJIT.lib
	${LLVM_LIBRARIES_PATH}/LLVMMCParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMMipsAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMMipsCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMMipsDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMMipsDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMMipsInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMMIRParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMMSP430AsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMMSP430CodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMMSP430Desc.lib
	${LLVM_LIBRARIES_PATH}/LLVMMSP430Disassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMMSP430Info.lib
	${LLVM_LIBRARIES_PATH}/LLVMNVPTXCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMNVPTXDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMNVPTXInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMObjCARCOpts.lib
	${LLVM_LIBRARIES_PATH}/LLVMObject.lib
	${LLVM_LIBRARIES_PATH}/LLVMObjectYAML.lib
	${LLVM_LIBRARIES_PATH}/LLVMOption.lib
	${LLVM_LIBRARIES_PATH}/LLVMOrcJIT.lib
	${LLVM_LIBRARIES_PATH}/LLVMOrcShared.lib
	${LLVM_LIBRARIES_PATH}/LLVMOrcTargetProcess.lib
	${LLVM_LIBRARIES_PATH}/LLVMPasses.lib
	${LLVM_LIBRARIES_PATH}/LLVMPowerPCAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMPowerPCCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMPowerPCDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMPowerPCDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMPowerPCInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMProfileData.lib
	${LLVM_LIBRARIES_PATH}/LLVMRemarks.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMRISCVUtils.lib
	${LLVM_LIBRARIES_PATH}/LLVMRuntimeDyld.lib
	${LLVM_LIBRARIES_PATH}/LLVMScalarOpts.lib
	${LLVM_LIBRARIES_PATH}/LLVMSelectionDAG.lib
	${LLVM_LIBRARIES_PATH}/LLVMSparcAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMSparcCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMSparcDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMSparcDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMSparcInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMSupport.lib
	${LLVM_LIBRARIES_PATH}/LLVMSymbolize.lib
	${LLVM_LIBRARIES_PATH}/LLVMSystemZAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMSystemZCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMSystemZDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMSystemZDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMSystemZInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMTableGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMTableGenGlobalISel.lib
	${LLVM_LIBRARIES_PATH}/LLVMTarget.lib
	${LLVM_LIBRARIES_PATH}/LLVMTestingSupport.lib
	${LLVM_LIBRARIES_PATH}/LLVMTextAPI.lib
	${LLVM_LIBRARIES_PATH}/LLVMTransformUtils.lib
	${LLVM_LIBRARIES_PATH}/LLVMVectorize.lib
	${LLVM_LIBRARIES_PATH}/LLVMWebAssemblyAsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMWebAssemblyCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMWebAssemblyDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMWebAssemblyDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMWebAssemblyInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMWindowsManifest.lib
	${LLVM_LIBRARIES_PATH}/LLVMX86AsmParser.lib
	${LLVM_LIBRARIES_PATH}/LLVMX86CodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMX86Desc.lib
	${LLVM_LIBRARIES_PATH}/LLVMX86Disassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMX86Info.lib
	${LLVM_LIBRARIES_PATH}/LLVMXCoreCodeGen.lib
	${LLVM_LIBRARIES_PATH}/LLVMXCoreDesc.lib
	${LLVM_LIBRARIES_PATH}/LLVMXCoreDisassembler.lib
	${LLVM_LIBRARIES_PATH}/LLVMXCoreInfo.lib
	${LLVM_LIBRARIES_PATH}/LLVMXRay.lib
	${LLVM_LIBRARIES_PATH}/LTO.lib
	${LLVM_LIBRARIES_PATH}/Remarks.lib
)

add_executable(${EXEC} ${ALL_FILES})
target_link_libraries(${EXEC} ${LLVM_LIBS})